<mat-tab-group class="h-full" mat-align-tabs="center">
    <mat-tab label="Persönliche Infos">
        <div class="p-6 max-h-3xl">
            <div fxLayout="column" fxLayoutAlign="start center" fxLayoutGap="20px">
                <ng-container *ngIf="authService.user$ | async as user">
                    <div *ngIf="!currentUser" fxLayoutAlign="center center">
                        <mat-spinner color="primary"
                                     diameter="25"></mat-spinner>
                    </div>
                    <ng-container *ngIf="currentUser">
                        <div class="w-full" fxLayout="row" fxLayoutAlign="space-evenly center">
                            <div fxLayout="column" fxLayoutGap="12px" fxLayoutAlign="center center" fxFlex="30"
                                 class="p-4 trans-ease-out relative">
                                <img class="avatar h-40 w-40 mx-auto" matRipple
                                     src="/assets/img/illustrations/idea.svg">

                                <button mat-mini-fab
                                        (click)="fileUpload.click()"
                                        class="bg-primary-light absolute top-0 right-20" color="accent">
                                    <mat-icon class="material-icons-round text-primary">edit</mat-icon>
                                </button>
                                <input [hidden]="true" type="file" #fileUpload id="fileUpload" name="fileUpload"
                                       multiple="multiple" accept="image/*"/>


                            </div>
                            <form (ngSubmit)="send()" class="px-6 py-4 max-w-lg" fxLayout="column" fxFlex="70"
                                  [formGroup]="form">
                                <div fxLayout="column" fxFlex formGroupName="info">
                                    <mat-form-field fxFlex="auto" appearance="standard">
                                        <mat-label>Vorname</mat-label>
                                        <input matInput formControlName="firstName">
                                        <div fxLayout matSuffix>
                                            <button (click)="form.get('info.firstName').disabled ?  onActivateForm('firstName') : onDeactivateForm('firstName') "
                                                    [matTooltip]="form.get('info.firstName').disabled ? 'Bearbeiten' : 'Speichern'"
                                                    class="font-xs" mat-icon-button matSuffix
                                                    type="button">
                                                <mat-icon>
                                                    {{form.get('info.firstName').disabled ? 'edit' : 'save' }}
                                                </mat-icon>
                                            </button>
                                        </div>
                                    </mat-form-field>
                                    <mat-form-field fxFlex="auto" appearance="standard">
                                        <mat-label>Nachname</mat-label>
                                        <input matInput required formControlName="lastName">
                                        <div fxLayout matSuffix>
                                            <button
                                                    (click)="form.get('info.lastName').disabled ?  onActivateForm('lastName') : onDeactivateForm('lastName') "
                                                    [matTooltip]="form.get('info.lastName').disabled ? 'Bearbeiten' : 'Speichern'"
                                                    class="font-xs" mat-icon-button
                                                    matSuffix type="button">
                                                <mat-icon>
                                                    {{form.get('info.lastName').disabled ? 'edit' : 'save'}}
                                                </mat-icon>
                                            </button>
                                        </div>
                                    </mat-form-field>
                                    <mat-form-field fxFlex="auto" appearance="standard">
                                        <mat-label>E-Mail</mat-label>
                                        <input matInput required formControlName="email">
                                        <div fxLayout matSuffix>
                                            <button
                                                    (click)="form.get('info.email').disabled ?  onActivateForm('email') : onDeactivateForm('email')"
                                                    [matTooltip]="form.get('info.email').disabled ? 'Bearbeiten' : 'Speichern'"
                                                    class="font-xs" mat-icon-button
                                                    matSuffix type="button">
                                                <mat-icon>
                                                    {{form.get('info.email').disabled ? 'edit' : 'save'}}
                                                </mat-icon>

                                            </button>
                                        </div>
                                    </mat-form-field>
                                    <mat-form-field fxFlex="auto" appearance="standard">
                                        <mat-label>Dein Slogan</mat-label>
                                        <textarea matInput
                                                  cdkTextareaAutosize
                                                  formControlName="slogan"
                                                  #autosize="cdkTextareaAutosize"
                                                  cdkAutosizeMinRows="1"
                                                  cdkAutosizeMaxRows="5"></textarea>
                                        <div fxLayout matSuffix>
                                            <button
                                                    (click)="form.get('info.slogan').disabled ?  onActivateForm('slogan') : onDeactivateForm('slogan')"
                                                    [matTooltip]="form.get('info.slogan').disabled ? 'Bearbeiten' : 'Speichern'"
                                                    class="font-xs" mat-icon-button
                                                    matSuffix type="button">
                                                <mat-icon>
                                                    {{form.get('info.slogan').disabled ? 'edit' : 'save'}}
                                                </mat-icon>

                                            </button>
                                        </div>
                                    </mat-form-field>
                                </div>


                                <mat-form-field fxFlex="auto" appearance="standard">
                                    <mat-label>Passwort ändern</mat-label>
                                    <input [type]="inputType" matInput formControlName="password">
                                    <div matSuffix fxLayout="row">
                                        <button (click)="togglePassword()" mat-icon-button type="button">
                                            <mat-icon *ngIf="visible">visibility</mat-icon>
                                            <mat-icon *ngIf="!visible">visibility_off</mat-icon>
                                        </button>
                                        <button *ngIf="form.get('password').value !== ''" mat-icon-button
                                                type="button">
                                            <mat-icon>save</mat-icon>
                                        </button>
                                    </div>

                                    <!--                                            <mat-error *ngIf="form.get('password').value && !form.get('password').valid">Oops, das Password erfüllt nicht unsere Anforderungen.</mat-error>-->
                                </mat-form-field>


                                <!--                                <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="8px">-->
                                <!--                                    <button routerLink="/" mat-button type="button">ABBRECHEN</button>-->
                                <!--                                    <button [color]="!isLoading ? 'primary' : null" mat-flat-button-->
                                <!--                                            type="submit">-->
                                <!--                                        <div *ngIf="isLoading" class="h-10 w-full" fxLayout="row"-->
                                <!--                                             fxLayoutAlign="center center">-->
                                <!--                                            <mat-spinner color="accent" diameter="25"></mat-spinner>-->
                                <!--                                        </div>-->
                                <!--                                        <span *ngIf="!isLoading">SPEICHERN</span>-->
                                <!--                                    </button>-->
                                <!--                                </div>-->
                            </form>
                        </div>
                    </ng-container>
                </ng-container>
            </div>
        </div>
    </mat-tab>
    <mat-tab label="Meine Aufnahmen">
        <div class="p-6 max-h-3xl">
            <div fxLayout="column" fxLayout.lt-md="column" fxLayoutGap="20px">
                <div fxLayout="row" fxLayoutAlign="space-evenly center">
                    <table [dataSource]="dataSource" class="w-full" mat-table matSort>

                        <!--- Note that these columns can be defined in any order.
                              The actual rendered columns are set as a property on the row definition" -->

                        <!-- Checkbox Column -->
                        <ng-container matColumnDef="checkbox">
                            <th *matHeaderCellDef mat-header-cell>
                                <mat-checkbox (change)="$event ? masterToggle() : null"
                                              [checked]="selection.hasValue() && isAllSelected()"
                                              [indeterminate]="selection.hasValue() && !isAllSelected()"
                                              color="primary">
                                </mat-checkbox>
                            </th>
                            <td *matCellDef="let row" class="w-4" mat-cell>
                                <mat-checkbox (change)="$event ? selection.toggle(row) : null"
                                              (click)="$event.stopPropagation()"
                                              [checked]="selection.isSelected(row)"
                                              color="primary">
                                </mat-checkbox>
                            </td>
                        </ng-container>

                        <!-- Image Column -->
                        <ng-container matColumnDef="image">
                            <th *matHeaderCellDef mat-header-cell></th>
                            <td *matCellDef="let row" class="w-8 min-w-8 pr-0" mat-cell>
                                <img [src]="row['imageSrc']" class="avatar h-8 w-8 align-middle">
                            </td>
                        </ng-container>

                        <!-- Text Columns -->
                        <ng-container *ngFor="let column of columns; trackBy: trackByProperty">
                            <ng-container *ngIf="column.type === 'text'" [matColumnDef]="column.property">
                                <th *matHeaderCellDef class="uppercase" mat-header-cell
                                    mat-sort-header> {{ column.label }}</th>
                                <td *matCellDef="let row" [ngClass]="column.cssClasses"
                                    mat-cell>{{ row[column.property] }}</td>
                            </ng-container>
                        </ng-container>

                        <!-- Contact Column -->
                        <ng-container matColumnDef="contact">
                            <th *matHeaderCellDef mat-header-cell mat-sort-header></th>
                            <td *matCellDef="let row" mat-cell>
                                <div class="flex">
                                    <a (click)="$event.stopPropagation()"
                                       class="w-8 h-8 leading-none flex items-center justify-center hover:bg-hover text-primary bg-primary-light"
                                       mat-icon-button>
                                        <mat-icon>add</mat-icon>
                                    </a>

                                    <a (click)="$event.stopPropagation()"
                                       class="w-8 h-8 leading-none flex items-center justify-center ml-1 hover:bg-hover text-teal bg-teal-light"
                                       mat-icon-button>
                                        <mat-icon>add</mat-icon>
                                    </a>

                                    <a (click)="$event.stopPropagation()"
                                       class="w-8 h-8 leading-none flex items-center justify-center ml-1 hover:bg-hover text-green bg-green-light"
                                       mat-icon-button>
                                        <mat-icon>add</mat-icon>
                                    </a>
                                </div>
                            </td>
                        </ng-container>

                        <!-- Label Column -->
                        <ng-container matColumnDef="labels">
                            <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header>Labels</th>
                            <td *matCellDef="let row" mat-cell>
                                <div (click)="$event.stopPropagation()" fxLayoutAlign="start center" fxLayoutGap="4px">
                                    <div *ngFor="let label of row.labels"
                                         [ngClass]="[label.textClass, label.bgClass]"
                                         class="rounded px-2 py-1 font-medium text-xs"
                                         fxFlex="none">
                                        {{ label.text }}
                                    </div>
                                    <div (click)="labelSelect.open()"
                                         class="text-secondary bg-base text-hint cursor-pointer hover:bg-hover"
                                         fxFlex="none"
                                         fxLayout="row"
                                         fxLayoutAlign="center center">
                                        <mat-icon>add</mat-icon>
                                    </div>
                                    <mat-select #labelSelect="matSelect"
                                                (selectionChange)="onLabelChange($event, row)"
                                                [value]="row.labels"
                                                class="invisible w-0 h-0 text-sm"
                                                fxFlex="0 1 0px"
                                                multiple>
                                        <mat-option *ngFor="let label of labels" [value]="label">
                                            <div [ngClass]="label.previewClass"
                                                 class="h-6 w-6 align-middle ltr:mr-2 rtl:ml-2 rounded inline-block"></div>
                                            <span>{{ label.text }}</span>
                                        </mat-option>
                                    </mat-select>
                                </div>
                            </td>
                        </ng-container>

                        <!-- Action Column -->
                        <ng-container matColumnDef="actions">
                            <th *matHeaderCellDef mat-header-cell mat-sort-header></th>
                            <td *matCellDef="let row" class="w-10 text-secondary" mat-cell>
                                <button (click)="$event.stopPropagation()"
                                        [matMenuTriggerData]="{ customer: row }"
                                        [matMenuTriggerFor]="actionsMenu"
                                        mat-icon-button
                                        type="button">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
                        <tr (click)="updateVideo(row)"
                            *matRowDef="let row; columns: visibleColumns;"
                            class="hover:bg-hover trans-ease-out cursor-pointer"
                            mat-row></tr>
                    </table>

                    <mat-paginator [pageSizeOptions]="pageSizeOptions" [pageSize]="pageSize"
                                   class="sticky left-0"></mat-paginator>
                </div>
            </div>
        </div>
    </mat-tab>
    <mat-tab label="Meine Einnahmen">
        <div class="p-6 max-h-3xl">
            <div fxLayout="column" fxLayout.lt-md="column" fxLayoutGap="20px">
                <div fxFlex="auto">
                    <div class="px-6 py-4 h-full" fxLayout="column" fxLayoutAlign="center">
                    </div>
                </div>
            </div>
        </div>
    </mat-tab>
</mat-tab-group>


<mat-menu #columnFilterMenu="matMenu" xPosition="before" yPosition="below">
    <button (click)="toggleColumnVisibility(column, $event)" *ngFor="let column of columns"
            class="checkbox-item mat-menu-item">
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="column.visible" color="primary">
            {{ column.label }}
        </mat-checkbox>
    </button>
</mat-menu>

<mat-menu #actionsMenu="matMenu" xPosition="before" yPosition="below">
    <ng-template let-customer="customer" matMenuContent>
        <button (click)="updateVideo(customer)" mat-menu-item>
            <mat-icon>add</mat-icon>
            <span>Modify</span>
        </button>
        <button (click)="deleteVideo(customer)" mat-menu-item>
            <mat-icon>add</mat-icon>
            <span>Delete</span>
        </button>
    </ng-template>
</mat-menu>
